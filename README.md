# Mulch Troop 589

## Location Map Visualization

This project generates an interactive map to visualize location data with
color-coded markers based on quantity ranges. The script uses the Folium
library to create the map and pandas to handle data from a CSV file. The
resulting map is saved as an HTML file.

It was originally created to support the distribution and routes for mulch
delivery for Troop 589. The map will automatically cluster addresss, to help
determine which orders can be sent together. 

You can view the an example of the HTML page here:

https://mulch-troop-589-confdisp-6b19e2acbbcc066ffbc2d43bdc88156fc7bcaa.gitlab.io/map-cluster.html


## Prerequisites

This project uses [uv](https://docs.astral.sh/uv/) to track dependencies.

Install uv and then run `uv sync` to set up this project.

## Data

The script expects a CSV file that is generated by TroopWebHost. The following
columns are required. Additional columns will be ignored.

- `Order Qty`
- `Order ID`
- `Address Line 1`
- `City`
- `State`
- `Zip`

The script will add (if needed) and fill in the following columns when run:

- `Latitude`
- `Longitude`

## Script Overview

1. **Load the CSV:** The script loads the CSV data from the given file.
2. **Process Coordinates:** For each row, the script will try to fill in
   latitude and longitude coordinates.
3. **Read the Data:** The script reads location data from the CSV file into a
   pandas DataFrame.
4. **Define Color Map:** It defines a color map to color-code markers based on
   the quantity (`Qty`) range.
5. **Define Boundary Coordinates:** Two sets of boundary coordinates are
   defined for potential use in the map.
6. **Create Map Object:** The Folium map object is created with the initial
   view centered on the mean latitude and longitude from the data.
7. **Add Markers:** A marker cluster is created and populated with markers for
   each location in the data, with custom HTML for each marker showing the
   quantity and order ID.
8. **Add Boundaries:** Boundary polygons are added to the map for visual
   reference.
9. **Save Map:** The map is saved as `map-cluster.html`.

## Usage

1. In TroopWebHost, go to menu->Sales->Export Orders To Excel. Click Export
   Order Detail.
2. Copy the CSV file the local directory (because it will be modified with
   coordinate columns and data).
3. Run the script (substitute your csv file name):

```bash
uv run createmapcluster.py "Export Orders To Excel 202542320658.csv"
```

4. The script will try to geocode every row. It may have trouble for some. It
   is safe to retry over and over, but you may need to manually add the
   coordinates for some rows. To manually discover coordinates, go to Google
   Maps, type in the address, click on it, and then get the coordinates from
   the URL.
5. Once all coordinates are filled in, rerun the script one final time. It will
   generate a "map-cluster.html" file. Open it in a web browser. Check that the
   row count from the csv matches the location count in the map (noting that
   DONATION rows are ignored). Once the map file is good, share with the mulch
   coordinator.

## Example

The example `example.csv` contains a stripped down, anonymized example of what
we download from TroopWebhost. The `map-cluster.html` is what is is produced
when `createmapcluster.py` is run against `example.csv`.

## Notes

- The color map is defined with specific ranges. Adjust the `color_map`
  dictionary if your data has different ranges.
- The boundary coordinates are optional and can be customized or removed as
  needed.
- Customize the HTML for the markers in the `html_text` variable as needed.

## License

This project is licensed under the MIT License. See the LICENSE file for more
details.

Forked from https://gitlab.com/confdisp/mulch-troop-589

## Authors

- Craig Antolick (original)
- Dan Rue
